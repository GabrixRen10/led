<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Controllo LED con Sensori</title>

<style>
  body {
    font-family: Arial;
    text-align: center;
    background: #f2f2f2;
  }
  button {
    font-size: 18px;
    padding: 10px 20px;
  }
</style>
</head>

<body>

<h2>Controllo LED con inclinazione ðŸ“±</h2>
<p>Inclina il telefono avanti</p>

<button onclick="enableSensor()">Attiva sensori</button>

<h3>LED accesi: <span id="value">0</span></h3>

<script>
const valueSpan = document.getElementById("value");

// ðŸ”´ METTI QUI L'IP DELL'ESP32
const ESP32_IP = "http://192.168.0.182"; // <-- CAMBIA QUESTO

let lastValue = -1;

function enableSensor() {
  if (typeof DeviceOrientationEvent.requestPermission === "function") {
    DeviceOrientationEvent.requestPermission()
      .then(permissionState => {
        if (permissionState === "granted") {
          window.addEventListener("deviceorientation", handleOrientation);
        }
      })
      .catch(console.error);
  } else {
    window.addEventListener("deviceorientation", handleOrientation);
  }
}

function handleOrientation(event) {
  const beta = event.beta; // inclinazione avanti/indietro
  if (beta === null) return;

  let leds = Math.floor((beta + 90) / 36); // scala â†’ 0â€“5
  if (leds < 0) leds = 0;
  if (leds > 5) leds = 5;

  if (leds !== lastValue) {
    lastValue = leds;
    valueSpan.innerText = leds;

    fetch(`${ESP32_IP}/set?value=${leds}`)
      .catch(() => {});
  }
}
</script>

</body>
</html>
